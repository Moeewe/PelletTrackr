<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      /* Echtes Fraenk-Design System */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: white;
        color: #000000;
        line-height: 1.4;
        font-size: 16px;
      }
      
      .app-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        min-height: 100vh;
        position: relative;
      }
      
      /* Header - Fraenk minimalistisch */
      .header {
        padding: 60px 32px 80px;
        text-align: left;
        background: white;
        border-bottom: 1px solid #f0f0f0;
      }
      
      .logo {
        font-size: 32px;
        font-weight: 400;
        margin-bottom: 8px;
        color: #000000;
        letter-spacing: -1px;
      }
      
      .tagline {
        font-size: 14px;
        color: #666666;
        font-weight: 400;
      }
      
      /* Main Content */
      .content {
        padding: 60px 32px;
      }
      
      .section {
        margin-bottom: 80px;
      }
      
      .section-title {
        font-size: 48px;
        font-weight: 700;
        line-height: 1.1;
        margin-bottom: 40px;
        color: #000000;
        letter-spacing: -2px;
      }
      
      /* Fraenk-typische große Headlines mit gelbem Highlight */
      .welcome-text {
        font-size: 40px;
        font-weight: 700;
        line-height: 1.1;
        margin-bottom: 60px;
        color: #000000;
        letter-spacing: -1px;
      }
      
      .highlight {
        background: #FFFF00;
        padding: 4px 8px;
        display: inline-block;
      }
      
      /* Form Styles - Fraenk minimalistisch */
      .form-group {
        margin-bottom: 32px;
      }
      
      .form-label {
        display: block;
        font-size: 16px;
        font-weight: 400;
        color: #000000;
        margin-bottom: 12px;
      }
      
      .form-input,
      .form-select {
        width: 100%;
        padding: 16px 0;
        border: none;
        border-bottom: 2px solid #e0e0e0;
        border-radius: 0;
        font-size: 18px;
        background: transparent;
        transition: border-color 0.2s ease;
        appearance: none;
        color: #000000;
      }
      
      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-bottom-color: #000000;
      }
      
      .form-input::placeholder {
        color: #999999;
      }
      
      .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23000000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0 center;
        background-repeat: no-repeat;
        background-size: 20px;
        padding-right: 30px;
      }
      
      /* Cost Preview - Gelbes Fraenk-Highlight */
      .cost-preview {
        background: #FFFF00;
        color: #000000;
        padding: 24px;
        border-radius: 0;
        text-align: center;
        margin: 40px 0;
        display: none;
        border: 2px solid #000000;
        transition: all 0.3s ease;
      }
      
      .cost-preview.show {
        display: block;
        animation: fadeIn 0.2s ease;
      }
      
      .cost-preview.calculating {
        background: #f0f0f0;
        color: #666666;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-4px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); }
      }
      
      .cost-preview.show.calculating {
        animation: pulse 1.5s infinite;
      }
      
      .cost-amount {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 8px;
        letter-spacing: -1px;
      }
      
      .cost-label {
        font-size: 16px;
        font-weight: 400;
      }
      
      /* Buttons - Fraenk Style */
      .btn {
        width: 100%;
        padding: 20px 24px;
        border: 2px solid #000000;
        border-radius: 0;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.15s ease;
        margin-bottom: 16px;
        text-align: center;
        background: white;
        color: #000000;
      }
      
      .btn-primary {
        background: #000000;
        color: white;
      }
      
      .btn-primary:hover {
        background: #333333;
      }
      
      .btn-secondary {
        background: white;
        color: #000000;
        border: 2px solid #000000;
      }
      
      .btn-secondary:hover {
        background: #FFFF00;
        border-color: #000000;
      }
      
      .btn-tertiary {
        background: white;
        color: #666666;
        border: 2px solid #e0e0e0;
      }
      
      .btn-tertiary:hover {
        border-color: #000000;
        color: #000000;
      }
      
      /* Status Messages */
      .status-message {
        padding: 20px;
        border: 2px solid #000000;
        margin: 24px 0;
        font-size: 16px;
        text-align: center;
        background: white;
      }
      
      .status-success {
        background: #FFFF00;
        color: #000000;
        border-color: #000000;
      }
      
      .status-error {
        background: white;
        color: #000000;
        border-color: #ff0000;
      }
      
      .status-info {
        background: white;
        color: #000000;
        border-color: #000000;
      }
      
      /* Overview Section */
      .overview-section {
        margin-top: 80px;
        padding-top: 60px;
        border-top: 2px solid #f0f0f0;
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 24px;
        margin: 40px 0;
      }
      
      .stat-card {
        background: white;
        padding: 32px 24px;
        border: 2px solid #f0f0f0;
        text-align: center;
      }
      
      .stat-number {
        font-size: 32px;
        font-weight: 700;
        color: #000000;
        margin-bottom: 8px;
        letter-spacing: -1px;
      }
      
      .stat-label {
        font-size: 14px;
        color: #666666;
        font-weight: 400;
      }
      
      /* Table - minimalistisch */
      .data-table {
        background: white;
        border: 2px solid #f0f0f0;
        margin: 40px 0;
        overflow-x: auto;
      }
      
      .data-table table {
        width: 100%;
        border-collapse: collapse;
        min-width: 600px;
      }
      
      .data-table th {
        background: white;
        padding: 20px 16px;
        font-size: 14px;
        font-weight: 600;
        color: #000000;
        text-align: left;
        border-bottom: 1px solid #f0f0f0;
        white-space: nowrap;
      }
      
      .data-table td {
        padding: 20px 16px;
        font-size: 16px;
        border-bottom: 1px solid #f8f8f8;
        color: #000000;
        white-space: nowrap;
      }
      
      .data-table tr:hover {
        background: #fafafa;
      }
      
      /* Responsive Table */
      @media (max-width: 800px) {
        .data-table {
          font-size: 14px;
        }
        
        .data-table th,
        .data-table td {
          padding: 12px 8px;
          font-size: 12px;
        }
        
        .data-table table {
          min-width: 500px;
        }
      }
      
      @media (max-width: 600px) {
        .data-table th,
        .data-table td {
          padding: 10px 6px;
          font-size: 11px;
        }
        
        .data-table table {
          min-width: 450px;
        }
      }
      
      /* Loading State */
      .loading {
        text-align: center;
        padding: 80px 20px;
        color: #666666;
      }
      
      .loading-spinner {
        display: inline-block;
        width: 24px;
        height: 24px;
        border: 2px solid #f0f0f0;
        border-top: 2px solid #000000;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 12px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #666666;
      }
      
      .empty-state-icon {
        font-size: 64px;
        margin-bottom: 24px;
        opacity: 0.3;
      }
      
      /* Responsive für größere Bildschirme */
      @media (min-width: 801px) {
        .app-container {
          max-width: 800px;
        }
        
        .stats-grid {
          grid-template-columns: repeat(4, 1fr);
          gap: 32px;
        }
        
        .form-group {
          margin-bottom: 40px;
        }
        
        .section {
          margin-bottom: 100px;
        }
        
        .overview-section {
          margin-top: 100px;
          padding-top: 80px;
        }
      }
      
      /* Responsive */
      @media (max-width: 800px) {
        .app-container {
          max-width: 90%;
          margin: 0 auto;
        }
        
        .header {
          padding: 50px 32px 70px;
        }
        
        .content {
          padding: 50px 32px;
        }
        
        .welcome-text {
          font-size: 36px;
        }
        
        .section-title {
          font-size: 42px;
        }
      }
      
      @media (max-width: 600px) {
        .app-container {
          max-width: 100%;
          margin: 0;
        }
        
        .header {
          padding: 40px 24px 60px;
        }
        
        .content {
          padding: 40px 24px;
        }
        
        .welcome-text {
          font-size: 32px;
        }
        
        .section-title {
          font-size: 36px;
        }
        
        .stats-grid {
          grid-template-columns: 1fr;
        }
        
        .form-group {
          margin-bottom: 24px;
        }
        
        .section {
          margin-bottom: 60px;
        }
      }
      
      @media (max-width: 480px) {
        .header {
          padding: 32px 20px 50px;
        }
        
        .content {
          padding: 32px 20px;
        }
        
        .welcome-text {
          font-size: 28px;
        }
        
        .section-title {
          font-size: 32px;
        }
        
        .cost-preview {
          padding: 20px;
          margin: 32px 0;
        }
        
        .cost-amount {
          font-size: 28px;
        }
        
        .btn {
          padding: 18px 20px;
          font-size: 16px;
        }
      }
      
      /* Fraenk-typische große Abstände */
      .spacer {
        height: 80px;
      }
      
      .spacer-small {
        height: 40px;
      }
    </style>
    <script>
      function AddRow() {
        // Eingabe-Validierung
        var name = document.getElementById("name").value.trim();
        var kennung = document.getElementById("kennung").value.trim();
        var material = document.getElementById("material").value.trim();
        var materialMenge = document.getElementById("materialMenge").value.trim();
        var masterbatch = document.getElementById("masterbatch").value.trim();
        var masterbatchMenge = document.getElementById("masterbatchMenge").value.trim();

        // Prüfe ob alle Felder ausgefüllt sind
        if (!name || !kennung || !material || !materialMenge || !masterbatch || !masterbatchMenge) {
          alert("Bitte alle Felder ausfüllen!");
          return;
        }

        // Numerische Validierung mit deutscher Zahlenformate-Unterstützung
        var materialMengeNum = parseGermanNumber(materialMenge);
        var masterbatchMengeNum = parseGermanNumber(masterbatchMenge);

        if (isNaN(materialMengeNum) || materialMengeNum <= 0) {
          alert("Bitte eine gültige Materialmenge eingeben (z.B. 1,5 oder 1.5)!");
          return;
        }

        if (isNaN(masterbatchMengeNum) || masterbatchMengeNum <= 0) {
          alert("Bitte eine gültige Masterbatch-Menge eingeben (z.B. 0,2 oder 0.2)!");
          return;
        }

        // Bestätigungsnachricht anzeigen
        showStatusMessage("⏳ Speichere Eintrag...", "info");

        // Apps Script-Funktion aufrufen
        google.script.run
          .withSuccessHandler(function(result) {
            if (result && result.success) {
              // Deutsche Formatierung für Kostenausgabe
              var formattedCost = result.totalCost ? result.totalCost.toFixed(2).replace('.', ',') + ' €' : "N/A";
              showStatusMessage(
                "✅ Eintrag gespeichert! Gesamtkosten: " + formattedCost, 
                "success"
              );
              
              // Speichere Name und Kennung vor dem Löschen
              var savedName = name;
              var savedKennung = kennung;
              clearForm();
              
              // Setze Name und Kennung für die Übersicht wieder ein
              document.getElementById("name").value = savedName;
              document.getElementById("kennung").value = savedKennung;
              
              // Automatisch Übersicht aktualisieren
              setTimeout(function() {
                showOverview();
              }, 1000);
            } else {
              showStatusMessage(
                "❌ Fehler beim Speichern: " + (result.error || "Unbekannter Fehler"),
                "error"
              );
            }
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Speichern:", error);
            showStatusMessage(
              "❌ Systemfehler beim Speichern: " + error.toString(),
              "error"
            );
          })
          .AddRecord(name, kennung, material, materialMengeNum, masterbatch, masterbatchMengeNum);
      }

      function clearForm() {
        // Nur Material-Felder löschen, Name und Kennung behalten
        document.getElementById("material").value = '';
        document.getElementById("materialMenge").value = '';
        document.getElementById("masterbatch").value = '';
        document.getElementById("masterbatchMenge").value = '';
        document.getElementById("costPreview").classList.remove('show');
      }

      function showOverview() {
        var name = document.getElementById("name").value.trim();
        var kennung = document.getElementById("kennung").value.trim();

        if (!name || !kennung) {
          alert("Bitte Name und FH Kennung eingeben!");
          return;
        }

        // Lade-Anzeige
        showLoading("overviewTable", "Lade deine Einträge...");

        console.log("Rufe getUserEntries auf mit:", name, kennung);
        
        google.script.run
          .withSuccessHandler(function(data) {
            console.log("Empfangene Daten:", data);
            var tableDiv = document.getElementById("overviewTable");
            
            // Robuste Null-Prüfung
            if (!data) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">📭</div>
                  <div>Keine Daten empfangen</div>
                </div>
              `;
              return;
            }
            
            // Fehlerbehandlung
            if (data.error) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">⚠️</div>
                  <div>Fehler: ${data.error}</div>
                </div>
              `;
              return;
            }
            
            // Debug-Informationen in Konsole
            if (data.debug) {
              console.log("Debug Info:", data.debug);
            }
            
            // Prüfe ob Einträge vorhanden sind
            if (!data.entries || data.entries.length === 0) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">📄</div>
                  <div>Noch keine Einträge vorhanden</div>
                  <div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">
                    Füge deinen ersten 3D-Druck hinzu!
                  </div>
                </div>
              `;
              return;
            }

            // Vollständige Tabelle erstellen mit allen relevanten Spalten
            var html = `
              <div class="data-table">
                <table>
                  <thead>
                    <tr>
                      <th>Datum</th>
                      <th>Material</th>
                      <th>Material Menge</th>
                      <th>Masterbatch</th>
                      <th>MB Menge</th>
                      <th>Gesamtkosten</th>
                    </tr>
                  </thead>
                  <tbody>
            `;

            // Datenzeilen hinzufügen
            data.entries.forEach(function(row, index) {
              if (row && Array.isArray(row)) {
                try {
                  // Datum formatieren
                  var date = row[0] ? new Date(row[0]).toLocaleDateString('de-DE') : 'N/A';
                  
                  // Daten extrahieren (basierend auf der Spaltenstruktur)
                  var material = row[4] || 'N/A';
                  var materialMenge = row[6] ? parseFloat(row[6]).toFixed(2) + ' kg' : '0,00 kg';
                  var masterbatch = row[7] || 'N/A';
                  var masterbatchMenge = row[9] ? parseFloat(row[9]).toFixed(2) + ' kg' : '0,00 kg';
                  var kosten = row[10] || 'N/A';
                  
                  html += `
                    <tr>
                      <td>${date}</td>
                      <td>${material}</td>
                      <td>${materialMenge}</td>
                      <td>${masterbatch}</td>
                      <td>${masterbatchMenge}</td>
                      <td><strong>${kosten}</strong></td>
                    </tr>
                  `;
                } catch (error) {
                  console.error("Fehler beim Verarbeiten von Zeile", index, ":", error);
                  html += `
                    <tr>
                      <td colspan="6" style="color: #999; font-style: italic;">
                        Fehler beim Laden der Zeile ${index + 1}
                      </td>
                    </tr>
                  `;
                }
              }
            });

            html += `
                  </tbody>
                </table>
              </div>
            `;
            
            // Zusammenfassung hinzufügen
            html += `
              <div style="text-align: center; margin-top: 24px; padding: 16px; background: #f8f8f8; border: 1px solid #e0e0e0;">
                <div style="font-weight: 600; margin-bottom: 8px; color: #333;">
                  📊 Zusammenfassung
                </div>
                <div style="font-size: 14px; color: #666;">
                  ✅ ${data.entries.length} Eintrag${data.entries.length !== 1 ? 'e' : ''} gefunden
                </div>
              </div>
            `;
            
            tableDiv.innerHTML = html;
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Abrufen der Daten:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Fehler beim Laden</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .getUserEntries(name, kennung);
      }
 
      function testConnection() {
        showLoading("overviewTable", "Teste Verbindung...");
        
        google.script.run
          .withSuccessHandler(function(data) {
            console.log("Test-Daten:", data);
            var tableDiv = document.getElementById("overviewTable");
            
            if (!data) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">❌</div>
                  <div>Keine Daten empfangen</div>
                </div>
              `;
              return;
            }
            
            if (data.success) {
              tableDiv.innerHTML = `
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-number">✅</div>
                    <div class="stat-label">Verbindung OK</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-number">${data.rowCount || 0}</div>
                    <div class="stat-label">Zeilen</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-number">${data.columnCount || 0}</div>
                    <div class="stat-label">Spalten</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-number">${data.sheetName || 'N/A'}</div>
                    <div class="stat-label">Tabellenblatt</div>
                  </div>
                </div>
                <div style="text-align: center; margin-top: 16px; color: #6c757d; font-size: 14px;">
                  ✅ Verbindung zur Datenbank erfolgreich
                </div>
              `;
            } else {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">❌</div>
                  <div>Verbindung fehlgeschlagen</div>
                  <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                    ${data.error || "Unbekannter Fehler"}
                  </div>
                </div>
              `;
            }
          })
          .withFailureHandler(function(error) {
            console.error("Test fehlgeschlagen:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Systemfehler beim Test</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .testConnection();
      }
      
      // Alternativ: Verwende getUserEntries für einen besseren Test
      function testWithUserData() {
        showLoading("overviewTable", "Teste mit echten Daten...");
        
        google.script.run
          .withSuccessHandler(function(data) {
            console.log("Test-Daten mit getUserEntries:", data);
            var tableDiv = document.getElementById("overviewTable");
            
            if (!data) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">❌</div>
                  <div>Keine Daten empfangen</div>
                </div>
              `;
              return;
            }
            
            if (data.error) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">⚠️</div>
                  <div>Fehler: ${data.error}</div>
                </div>
              `;
              return;
            }
            
            // Zeige Debug-Informationen
            var debugInfo = data.debug || {};
            var html = `
              <div style="margin-bottom: 24px; padding: 16px; background: #FFFF00; border: 2px solid #000000;">
                <div style="font-weight: 600; margin-bottom: 8px;">🔍 Verbindungstest mit echten Daten</div>
                <div style="font-size: 14px; color: #666;">
                  Test mit mm123289 Kennung
                </div>
              </div>
              
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-number">${debugInfo.totalRows || 0}</div>
                  <div class="stat-label">Gesamt Zeilen</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${debugInfo.filteredRows || 0}</div>
                  <div class="stat-label">Gefilterte Zeilen</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${data.entries ? data.entries.length : 0}</div>
                  <div class="stat-label">Einträge</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${data.headers ? data.headers.length : 0}</div>
                  <div class="stat-label">Spalten</div>
                </div>
              </div>
            `;
            
            // Zeige Beispiel-Daten wenn vorhanden
            if (data.entries && data.entries.length > 0) {
              html += `
                <div style="margin-top: 24px;">
                  <div style="font-weight: 600; margin-bottom: 12px; color: #333;">📋 Beispiel-Einträge:</div>
                  <div class="data-table">
                    <table>
                      <thead>
                        <tr>
                          <th>Datum</th>
                          <th>Name</th>
                          <th>FH-Kennung</th>
                          <th>Material</th>
                          <th>Kosten</th>
                        </tr>
                      </thead>
                      <tbody>
              `;
              
              // Zeige nur die ersten 3 Einträge
              var maxEntries = Math.min(3, data.entries.length);
              for (var i = 0; i < maxEntries; i++) {
                var entry = data.entries[i];
                html += `
                  <tr>
                    <td>${entry[0] ? new Date(entry[0]).toLocaleDateString('de-DE') : 'N/A'}</td>
                    <td>${entry[1] || 'N/A'}</td>
                    <td>${entry[2] || 'N/A'}</td>
                    <td>${entry[4] || 'N/A'}</td>
                    <td>${entry[10] || 'N/A'}</td>
                  </tr>
                `;
              }
              
              html += `
                      </tbody>
                    </table>
                  </div>
                </div>
              `;
            }
            
            tableDiv.innerHTML = html;
          })
          .withFailureHandler(function(error) {
            console.error("Test fehlgeschlagen:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Systemfehler beim Test</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .getUserEntries("Test", "mm123289");
      }
      
      // Neue JavaScript-Funktionen für erweiterte Features
      function loadMaterials() {
        google.script.run
          .withSuccessHandler(function(result) {
            if (result.success) {
              var select = document.getElementById("material");
              select.innerHTML = '<option value="">Material auswählen...</option>';
              
              result.materials.forEach(function(material) {
                var option = document.createElement("option");
                option.value = material.name;
                option.textContent = material.name + " (" + material.price.toFixed(2) + " " + material.currency + "/kg)";
                select.appendChild(option);
              });
            }
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Laden der Materialien:", error);
          })
          .getMaterials();
      }
      
      function loadMasterbatches() {
        google.script.run
          .withSuccessHandler(function(result) {
            if (result.success) {
              var select = document.getElementById("masterbatch");
              select.innerHTML = '<option value="">Masterbatch auswählen...</option>';
              
              result.masterbatches.forEach(function(masterbatch) {
                var option = document.createElement("option");
                option.value = masterbatch.name;
                option.textContent = masterbatch.name + " (" + masterbatch.price.toFixed(2) + " " + masterbatch.currency + "/kg)";
                select.appendChild(option);
              });
            }
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Laden der Masterbatches:", error);
          })
          .getMasterbatches();
      }
      
      // Hilfsfunktion für deutsche Zahlenformate
      function parseGermanNumber(value) {
        if (!value || value === '') return 0;
        
        // Entferne alle Zeichen außer Zahlen, Komma und Punkt
        var cleaned = value.toString().replace(/[^\d,.-]/g, '');
        
        // Konvertiere deutschen Dezimaltrennzeichen (Komma) zu Punkt
        var normalizedValue = cleaned.replace(',', '.');
        var parsedValue = parseFloat(normalizedValue);
        
        // Prüfe auf gültige Zahl
        return isNaN(parsedValue) ? 0 : parsedValue;
      }
      
      // Throttle-Funktion für bessere Performance
      function throttle(func, limit) {
        let inThrottle;
        return function() {
          const args = arguments;
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        }
      }
      
      function calculateCostPreview() {
        var material = document.getElementById("material").value;
        var materialMenge = document.getElementById("materialMenge").value;
        var masterbatch = document.getElementById("masterbatch").value;
        var masterbatchMenge = document.getElementById("masterbatchMenge").value;
        var preview = document.getElementById("costPreview");
        
        // Deutsche Zahlenformate korrekt parsen
        var matMenge = parseGermanNumber(materialMenge);
        var mbMenge = parseGermanNumber(masterbatchMenge);
        
        // Zeige Vorschau nur wenn mindestens ein Wert > 0 ist
        if ((material && matMenge > 0) || (masterbatch && mbMenge > 0)) {
          // Setze fehlende Werte auf 0 für die Berechnung
          var matName = material || "";
          var mbName = masterbatch || "";
          
          // Sofortige Anzeige während der Berechnung
          preview.querySelector('.cost-amount').textContent = "Berechne...";
          preview.classList.add('show', 'calculating');
          
          google.script.run
            .withSuccessHandler(function(result) {
              preview.classList.remove('calculating');
              if (result && result.success) {
                // Verwende die korrekte Gesamtsumme aus der Backend-Berechnung
                var formattedCost = result.totalCost.toFixed(2).replace('.', ',') + ' €';
                preview.querySelector('.cost-amount').textContent = formattedCost;
                preview.classList.add('show');
                
                // Debug-Ausgabe für Kontrolle
                console.log("Kostenberechnung:", {
                  material: matName,
                  materialMenge: matMenge,
                  materialCost: result.materialCost,
                  masterbatch: mbName,
                  masterbatchMenge: mbMenge,
                  masterbatchCost: result.masterbatchCost,
                  totalCost: result.totalCost
                });
                
                // Kleine Animation bei Erfolg
                preview.style.transform = 'scale(1.02)';
                setTimeout(function() {
                  preview.style.transform = 'scale(1)';
                }, 200);
              } else {
                preview.querySelector('.cost-amount').textContent = "Fehler bei Berechnung";
                preview.classList.add('show');
              }
            })
            .withFailureHandler(function(error) {
              console.error("Fehler bei Kostenberechnung:", error);
              preview.classList.remove('calculating');
              preview.querySelector('.cost-amount').textContent = "Fehler bei Berechnung";
              preview.classList.add('show');
            })
            .calculateCost(matName, matMenge, mbName, mbMenge);
        } else {
          preview.classList.remove('show', 'calculating');
        }
      }
      
      // Throttled Version für bessere Performance (reduziert auf 150ms für schnellere Reaktion)
      var throttledCalculateCost = throttle(calculateCostPreview, 150);
      
      function showStatusMessage(message, type = 'info') {
        var confirmation = document.getElementById("confirmation");
        confirmation.className = `status-message status-${type}`;
        confirmation.innerHTML = message;
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
          confirmation.innerHTML = '';
          confirmation.className = '';
        }, 5000);
      }
      
      function showLoading(elementId, message = 'Laden...') {
        var element = document.getElementById(elementId);
        element.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            ${message}
          </div>
        `;
      }
      
      function showStatistics() {
        var name = document.getElementById("name").value.trim();
        var kennung = document.getElementById("kennung").value.trim();

        if (!name || !kennung) {
          alert("Bitte Name und FH Kennung eingeben!");
          return;
        }

        showLoading("overviewTable", "Erstelle deine Statistiken...");

        google.script.run
          .withSuccessHandler(function(result) {
            var tableDiv = document.getElementById("overviewTable");
            
            if (!result.success) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">⚠️</div>
                  <div>Fehler: ${result.error}</div>
                </div>
              `;
              return;
            }
            
            var stats = result.statistics;
            var html = `
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-number">${stats.totalEntries}</div>
                  <div class="stat-label">Einträge</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalMaterialUsage.toFixed(1)}</div>
                  <div class="stat-label">kg Material</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalMasterbatchUsage.toFixed(1)}</div>
                  <div class="stat-label">kg Masterbatch</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalCost.toFixed(0)}€</div>
                  <div class="stat-label">Gesamtkosten</div>
                </div>
              </div>
            `;
            
            // Material-Aufschlüsselung
            if (Object.keys(stats.materialTypes).length > 0) {
              html += `<div style="margin-top: 24px;">`;
              html += `<div style="font-weight: 600; margin-bottom: 12px; color: #333;">Deine Materialien:</div>`;
              for (var material in stats.materialTypes) {
                html += `
                  <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                    <span style="color: #666;">${material}</span>
                    <span style="font-weight: 600;">${stats.materialTypes[material].toFixed(2)} kg</span>
                  </div>
                `;
              }
              html += `</div>`;
            }
            
            tableDiv.innerHTML = html;
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Abrufen der Statistiken:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Fehler beim Laden der Statistiken</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .getUserStatistics(name, kennung);
      }
      
      function debugPrices() {
        showLoading("overviewTable", "Debug läuft...");
        
        google.script.run
          .withSuccessHandler(function(data) {
            console.log("=== DEBUG ERGEBNIS ===");
            console.log(data);
            
            var tableDiv = document.getElementById("overviewTable");
            
            if (data.success) {
              var html = `
                <div style="font-family: monospace; font-size: 12px; text-align: left; white-space: pre-wrap;">
                  <strong>Material-Tabelle:</strong>
                  ${JSON.stringify(data.materialData, null, 2)}
                  
                  <strong>Masterbatch-Tabelle:</strong>
                  ${JSON.stringify(data.masterbatchData, null, 2)}
                  
                  <strong>Verarbeitete Materialien:</strong>
                  ${JSON.stringify(data.materials, null, 2)}
                  
                  <strong>Verarbeitete Masterbatches:</strong>
                  ${JSON.stringify(data.masterbatches, null, 2)}
                </div>
              `;
              tableDiv.innerHTML = html;
            } else {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">❌</div>
                  <div>Debug fehlgeschlagen</div>
                  <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                    ${data.error}
                  </div>
                </div>
              `;
            }
          })
          .withFailureHandler(function(error) {
            console.error("Debug fehlgeschlagen:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Debug fehlgeschlagen</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .debugPrices();
      }
      
      // Admin-Funktionen
      function showAdminView() {
        showLoading("overviewTable", "Lade alle Einträge...");
        
        google.script.run
          .withSuccessHandler(function(data) {
            console.log("Admin-Daten empfangen:", data);
            var tableDiv = document.getElementById("overviewTable");
            
            if (!data) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">📭</div>
                  <div>Keine Daten empfangen</div>
                </div>
              `;
              return;
            }
            
            if (data.error) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">⚠️</div>
                  <div>Fehler: ${data.error}</div>
                </div>
              `;
              return;
            }
            
            if (!data.entries || data.entries.length === 0) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">📄</div>
                  <div>Keine Einträge vorhanden</div>
                  <div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">
                    Noch keine 3D-Drucke erfasst
                  </div>
                </div>
              `;
              return;
            }

            // Admin-Tabelle mit allen Einträgen erstellen
            var html = `
              <div style="margin-bottom: 24px; padding: 16px; background: #FFFF00; border: 2px solid #000000;">
                <div style="font-weight: 600; margin-bottom: 8px;">🔧 Admin-Ansicht</div>
                <div style="font-size: 14px; color: #666;">
                  Alle Einträge • ${data.entries.length} gesamt
                </div>
              </div>
              
              <div class="data-table">
                <table>
                  <thead>
                    <tr>
                      <th>Datum</th>
                      <th>Name</th>
                      <th>FH-Kennung</th>
                      <th>Material</th>
                      <th>Mat. Menge</th>
                      <th>Masterbatch</th>
                      <th>MB Menge</th>
                      <th>Kosten</th>
                      <th>Bezahlt</th>
                      <th>Aktion</th>
                    </tr>
                  </thead>
                  <tbody>
            `;

            // Alle Einträge durchgehen
            data.entries.forEach(function(row, index) {
              if (row && Array.isArray(row)) {
                try {
                  // Eindeutige ID für den Eintrag erstellen (aus Datum + Name + Kennung)
                  var entryId = `${row[0]}_${row[1]}_${row[2]}`.replace(/[^a-zA-Z0-9]/g, '_');
                  
                  // Daten extrahieren
                  var date = row[0] ? new Date(row[0]).toLocaleDateString('de-DE') : 'N/A';
                  var name = row[1] || 'N/A';
                  var kennung = row[2] || 'N/A';
                  var material = row[4] || 'N/A';
                  var materialMenge = row[6] ? parseFloat(row[6]).toFixed(2) + ' kg' : '0,00 kg';
                  var masterbatch = row[7] || 'N/A';
                  var masterbatchMenge = row[9] ? parseFloat(row[9]).toFixed(2) + ' kg' : '0,00 kg';
                  var kosten = row[10] || 'N/A';
                  var bezahlt = row[11] || 'Nein';
                  var bezahltDatum = row[12] ? new Date(row[12]).toLocaleDateString('de-DE') : '';
                  
                  // Status-Anzeige
                  var statusHtml = '';
                  if (bezahlt === 'Ja') {
                    statusHtml = `
                      <div style="color: #28a745; font-weight: 600;">✅ Ja</div>
                      <div style="font-size: 12px; color: #666;">${bezahltDatum}</div>
                    `;
                  } else {
                    statusHtml = `<div style="color: #dc3545; font-weight: 600;">❌ Nein</div>`;
                  }
                  
                  // Aktion-Button
                  var actionHtml = '';
                  if (bezahlt !== 'Ja') {
                    actionHtml = `
                      <button onclick="markAsPaid(${index}, '${name}', '${kennung}', '${row[0]}')" 
                              style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        Als bezahlt markieren
                      </button>
                    `;
                  } else {
                    actionHtml = `<div style="color: #666; font-size: 12px;">Bereits bezahlt</div>`;
                  }
                  
                  html += `
                    <tr id="entry-${index}">
                      <td>${date}</td>
                      <td>${name}</td>
                      <td>${kennung}</td>
                      <td>${material}</td>
                      <td>${materialMenge}</td>
                      <td>${masterbatch}</td>
                      <td>${masterbatchMenge}</td>
                      <td><strong>${kosten}</strong></td>
                      <td>${statusHtml}</td>
                      <td>${actionHtml}</td>
                    </tr>
                  `;
                } catch (error) {
                  console.error("Fehler beim Verarbeiten von Admin-Zeile", index, ":", error);
                }
              }
            });

            html += `
                  </tbody>
                </table>
              </div>
            `;
            
            tableDiv.innerHTML = html;
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Laden der Admin-Daten:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Fehler beim Laden der Admin-Ansicht</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .getAllEntries();
      }
      
      function markAsPaid(rowIndex, name, kennung, timestamp) {
        // Bestätigung
        if (!confirm(`Eintrag von ${name} (${kennung}) als bezahlt markieren?`)) {
          return;
        }
        
        // Button während der Verarbeitung deaktivieren
        var button = document.querySelector(`#entry-${rowIndex} button`);
        if (button) {
          button.disabled = true;
          button.textContent = "Wird gespeichert...";
          button.style.background = "#6c757d";
        }
        
        google.script.run
          .withSuccessHandler(function(result) {
            if (result && result.success) {
              showStatusMessage("✅ Eintrag als bezahlt markiert!", "success");
              
              // Zeile visuell aktualisieren
              var row = document.getElementById(`entry-${rowIndex}`);
              if (row) {
                var statusCell = row.cells[8]; // Bezahlt-Spalte
                var actionCell = row.cells[9]; // Aktion-Spalte
                
                statusCell.innerHTML = `
                  <div style="color: #28a745; font-weight: 600;">✅ Ja</div>
                  <div style="font-size: 12px; color: #666;">${new Date().toLocaleDateString('de-DE')}</div>
                `;
                
                actionCell.innerHTML = `<div style="color: #666; font-size: 12px;">Bereits bezahlt</div>`;
                
                // Zeile kurz hervorheben
                row.style.background = "#d4edda";
                setTimeout(function() {
                  row.style.background = "";
                }, 2000);
              }
            } else {
              showStatusMessage(
                "❌ Fehler beim Markieren: " + (result.error || "Unbekannter Fehler"),
                "error"
              );
              
              // Button wieder aktivieren
              if (button) {
                button.disabled = false;
                button.textContent = "Als bezahlt markieren";
                button.style.background = "#28a745";
              }
            }
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Markieren als bezahlt:", error);
            showStatusMessage(
              "❌ Systemfehler: " + error.toString(),
              "error"
            );
            
            // Button wieder aktivieren
            if (button) {
              button.disabled = false;
              button.textContent = "Als bezahlt markieren";
              button.style.background = "#28a745";
            }
          })
          .markAsPaid(name, kennung, timestamp);
      }
      
      function showAdminStatistics() {
        showLoading("overviewTable", "Lade Admin-Statistiken...");
        
        google.script.run
          .withSuccessHandler(function(result) {
            var tableDiv = document.getElementById("overviewTable");
            
            if (!result.success) {
              tableDiv.innerHTML = `
                <div class="empty-state">
                  <div class="empty-state-icon">⚠️</div>
                  <div>Fehler: ${result.error}</div>
                </div>
              `;
              return;
            }
            
            var stats = result.statistics;
            var html = `
              <div style="margin-bottom: 24px; padding: 16px; background: #FFFF00; border: 2px solid #000000;">
                <div style="font-weight: 600; margin-bottom: 8px;">📊 Admin-Statistiken</div>
                <div style="font-size: 14px; color: #666;">
                  Gesamtübersicht aller Nutzer und Einträge
                </div>
              </div>
              
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-number">${stats.totalEntries}</div>
                  <div class="stat-label">Gesamt Einträge</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalUsers}</div>
                  <div class="stat-label">Aktive Nutzer</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalPaidEntries}</div>
                  <div class="stat-label">Bezahlt</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalUnpaidEntries}</div>
                  <div class="stat-label">Offen</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalMaterialUsage.toFixed(1)}</div>
                  <div class="stat-label">kg Material</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalMasterbatchUsage.toFixed(1)}</div>
                  <div class="stat-label">kg Masterbatch</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.totalRevenue.toFixed(0)}€</div>
                  <div class="stat-label">Gesamtumsatz</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">${stats.unpaidRevenue.toFixed(0)}€</div>
                  <div class="stat-label">Offene Beträge</div>
                </div>
              </div>
            `;
            
            // Top-Nutzer anzeigen
            if (stats.topUsers && stats.topUsers.length > 0) {
              html += `
                <div style="margin-top: 40px;">
                  <div style="font-weight: 600; margin-bottom: 16px; color: #333;">🏆 Top-Nutzer:</div>
                  <div class="data-table">
                    <table>
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>FH-Kennung</th>
                          <th>Einträge</th>
                          <th>Gesamtkosten</th>
                        </tr>
                      </thead>
                      <tbody>
              `;
              
              stats.topUsers.forEach(function(user, index) {
                html += `
                  <tr>
                    <td>${user.name}</td>
                    <td>${user.kennung}</td>
                    <td>${user.entries}</td>
                    <td><strong>${user.totalCost.toFixed(2)} €</strong></td>
                  </tr>
                `;
              });
              
              html += `
                      </tbody>
                    </table>
                  </div>
                </div>
              `;
            }
            
            // Material-Aufschlüsselung
            if (stats.materialTypes && Object.keys(stats.materialTypes).length > 0) {
              html += `
                <div style="margin-top: 40px;">
                  <div style="font-weight: 600; margin-bottom: 16px; color: #333;">📦 Material-Verbrauch:</div>
              `;
              
              for (var material in stats.materialTypes) {
                var usage = stats.materialTypes[material];
                html += `
                  <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f0f0f0; background: #f8f8f8;">
                    <span style="font-weight: 500;">${material}</span>
                    <span style="color: #666;">${usage.toFixed(2)} kg</span>
                  </div>
                `;
              }
              
              html += `</div>`;
            }
            
            tableDiv.innerHTML = html;
          })
          .withFailureHandler(function(error) {
            console.error("Fehler beim Abrufen der Admin-Statistiken:", error);
            document.getElementById("overviewTable").innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">❌</div>
                <div>Fehler beim Laden der Admin-Statistiken</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">
                  ${error.toString()}
                </div>
              </div>
            `;
          })
          .getAdminStatistics();
      }
      
      // Beim Laden der Seite Dropdowns füllen
      window.onload = function() {
        loadMaterials();
        loadMasterbatches();
        
        // Event Listener für Live-Kostenberechnung mit Throttling
        document.getElementById("materialMenge").addEventListener("input", throttledCalculateCost);
        document.getElementById("masterbatchMenge").addEventListener("input", throttledCalculateCost);
        document.getElementById("material").addEventListener("change", calculateCostPreview);
        document.getElementById("masterbatch").addEventListener("change", calculateCostPreview);
        
        // Zusätzliche Event-Listener für sofortige Reaktion bei Dropdown-Änderungen
        document.getElementById("material").addEventListener("change", function() {
          // Sofortige Berechnung bei Dropdown-Änderung (ohne Throttling)
          setTimeout(calculateCostPreview, 50);
        });
        
        document.getElementById("masterbatch").addEventListener("change", function() {
          // Sofortige Berechnung bei Dropdown-Änderung (ohne Throttling)
          setTimeout(calculateCostPreview, 50);
        });
        
        // Verbesserte Eingabevalidierung für deutsche Zahlenformate
        document.getElementById("materialMenge").addEventListener("blur", function() {
          var value = this.value;
          if (value) {
            var parsed = parseGermanNumber(value);
            if (parsed > 0) {
              this.value = parsed.toFixed(2).replace('.', ',');
            }
          }
        });
        
        document.getElementById("masterbatchMenge").addEventListener("blur", function() {
          var value = this.value;
          if (value) {
            var parsed = parseGermanNumber(value);
            if (parsed > 0) {
              this.value = parsed.toFixed(2).replace('.', ',');
            }
          }
        });
      };
      
      // Wrapper-Funktionen für die Buttons
      function showUserOverview() {
        var name = document.getElementById("name").value.trim();
        var kennung = document.getElementById("kennung").value.trim();
        
        if (!name || !kennung) {
          showStatusMessage("⚠️ Bitte erst Name und FH-Kennung eingeben!", "error");
          return;
        }
        
        showOverview();
      }
      
      function showUserStatistics() {
        var name = document.getElementById("name").value.trim();
        var kennung = document.getElementById("kennung").value.trim();
        
        if (!name || !kennung) {
          showStatusMessage("⚠️ Bitte erst Name und FH-Kennung eingeben!", "error");
          return;
        }
        
        showStatistics();
      }
    </script>
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <div class="header">
        <div class="logo">fraenk</div>
      </div>
      
      <!-- Main Content -->
      <div class="content">
        <!-- Welcome Section -->
        <div class="section">
          <div class="welcome-text">
            <span class="highlight">Super schnell</span> zum<br>
            3D-Druck Eintrag
          </div>
        </div>
        
        <!-- Form Section -->
        <div class="section">
          <div class="form-group">
            <label class="form-label">Dein Name</label>
            <input type="text" id="name" class="form-input" placeholder="Max Mustermann" />
          </div>
          
          <div class="form-group">
            <label class="form-label">FH Kennung</label>
            <input type="text" id="kennung" class="form-input" placeholder="m.mustermann" />
          </div>
          
          <div class="form-group">
            <label class="form-label">Material</label>
            <select id="material" class="form-select">
              <option value="">Material auswählen...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Material Menge (kg)</label>
            <input type="text" id="materialMenge" class="form-input" placeholder="0,00 oder 0.00" />
          </div>
          
          <div class="form-group">
            <label class="form-label">Masterbatch</label>
            <select id="masterbatch" class="form-select">
              <option value="">Masterbatch auswählen...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Masterbatch Menge (kg)</label>
            <input type="text" id="masterbatchMenge" class="form-input" placeholder="0,00 oder 0.00" />
          </div>
          
          <!-- Cost Preview -->
          <div id="costPreview" class="cost-preview">
            <div class="cost-amount">0,00 €</div>
            <div class="cost-label">Voraussichtliche Kosten</div>
          </div>
          
          <!-- Action Buttons -->
          <button class="btn btn-primary" onclick="AddRow()">
            Eintrag hinzufügen
          </button>
        </div>
        
        <!-- Status Messages -->
        <div id="confirmation"></div>
        
        <!-- Navigation/Action Buttons -->
        <div class="section">
          <div class="section-title"><span class="highlight">Aktionen</span><br>& Übersicht</div>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <button onclick="showUserOverview()" style="flex: 1; min-width: 120px; background: #000000; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500;">
              📊 Meine Übersicht
            </button>
            <button onclick="showUserStatistics()" style="flex: 1; min-width: 120px; background: #000000; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500;">
              📈 Meine Statistiken
            </button>
            <button onclick="showAdminView()" style="flex: 1; min-width: 120px; background: #dc3545; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500;">
              🔧 Admin: Alle Einträge
            </button>
            <button onclick="showAdminStatistics()" style="flex: 1; min-width: 120px; background: #dc3545; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500;">
              📊 Admin: Statistiken
            </button>
            <button onclick="testWithUserData()" style="flex: 1; min-width: 120px; background: #666666; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500;">
              🔧 Verbindung testen
            </button>
            <button onclick="debugPrices()" style="flex: 1; min-width: 120px; background: #666666; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500;">
              🔧 Debug Preise
            </button>
          </div>
        </div>
        
        <!-- Overview Section -->
        <div class="overview-section">
          <div class="section-title"><span class="highlight">Deine</span><br>Einträge</div>
          <div id="overviewTable" class="data-table"></div>
        </div>
      </div>
    </div>
  </body>
</html>
